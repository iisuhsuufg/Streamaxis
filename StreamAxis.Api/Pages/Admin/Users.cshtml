@page
@model StreamAxis.Api.Pages.Admin.UsersModel
@{
    ViewData["Title"] = "Users";
    Layout = "_AdminLayout";
}

<div class="page-header">
    <h1>Users & Devices</h1>
</div>

@if (!string.IsNullOrEmpty(Model.Message))
{
    <div class="alert @(Model.Message.Contains("success") ? "alert-success" : "alert-info")">
        @Model.Message
    </div>
}

<div class="card">
    <div class="card-header">
        <h3>Add New User</h3>
    </div>
    <div class="card-body">
        <form method="post" asp-page-handler="Create" class="form-inline">
            <div class="form-group">
                <label>Username</label>
                <input type="text" name="username" placeholder="Username" required />
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" name="password" placeholder="Password" required />
            </div>
            <div class="form-group">
                <label>Max Devices</label>
                <input type="number" name="maxDevices" value="3" min="1" max="99" />
            </div>
            <div class="form-group">
                <label>Expiration Date</label>
                <input type="date" name="expirationDate" value="@DateTime.UtcNow.AddMonths(1).ToString("yyyy-MM-dd")" />
            </div>
            <button type="submit" class="btn btn-primary">Create User</button>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Manage Users</h3>
        <form method="get" class="search-form">
            <input type="text" name="q" value="@Model.Query" placeholder="Search username..." />
            <button type="submit" class="btn btn-secondary">Search</button>
        </form>
    </div>
    <div class="card-body">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Status</th>
                    <th>Max Devices</th>
                    <th>Expiration</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var u in Model.Users)
                {
                    <tr>
                        <td>@u.Id</td>
                        <td><strong>@u.Username</strong></td>
                        <td>
                            <span class="badge @(u.IsActive ? "badge-success" : "badge-danger")">
                                @(u.IsActive ? "Active" : "Inactive")
                            </span>
                        </td>
                        <td>@u.MaxDevices</td>
                        <td>@u.ExpirationDate.ToString("yyyy-MM-dd")</td>
                        <td class="actions">
                            <a asp-page="/Admin/UserEdit" asp-route-id="@u.Id" class="btn btn-sm">Edit</a>
                            @if (u.Username.ToLower() != "admin")
                            {
                                <form method="post" asp-page-handler="Delete" style="display:inline;">
                                    <input type="hidden" name="userId" value="@u.Id" />
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete user @u.Username?')">Delete</button>
                                </form>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
